<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitLoop - AI Feedback Optimizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Navigation -->
        <nav class="bg-gradient-to-r from-primary to-secondary text-white p-4">
            <div class="container mx-auto">
                <h1 class="text-2xl font-bold">FitLoop - AI Feedback Optimizer</h1>
                <p class="text-sm opacity-90">Professional Retail Analytics Platform</p>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container mx-auto px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <!-- Upload Section -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                    <h2 class="text-xl font-bold mb-4 text-gray-800">Upload CSV Files</h2>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Reviews CSV</label>
                            <input type="file" id="reviewsFile" accept=".csv" 
                                   class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Returns CSV</label>
                            <input type="file" id="returnsFile" accept=".csv"
                                   class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    <button onclick="uploadFiles()" 
                            class="mt-4 bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary-dark">
                        Upload & Process
                    </button>
                </div>

                <!-- Results Section -->
                <div id="results" class="bg-white rounded-lg shadow-lg p-6" style="display: none;">
                    <h2 class="text-xl font-bold mb-4 text-gray-800">Analysis Results</h2>
                    <div id="productGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>

                <!-- Demo Data Button -->
                <div class="text-center mt-8">
                    <button onclick="loadDemoData()" 
                            class="bg-secondary text-white px-8 py-3 rounded-lg hover:bg-secondary-dark">
                        Load Demo Data (18 Reviews + 8 Returns)
                    </button>
                </div>

                <!-- API Status -->
                <div class="mt-8 text-center">
                    <div id="apiStatus" class="text-sm text-gray-600">
                        API Status: <span id="statusText">Checking...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        const AUTH_TOKEN = 'fitloop2024';

        // Check API status
        async function checkAPIStatus() {
            try {
                const response = await fetch(`${API_BASE}/`);
                if (response.ok) {
                    document.getElementById('statusText').textContent = '✅ Backend Running';
                } else {
                    document.getElementById('statusText').textContent = '❌ Backend Error';
                }
            } catch (error) {
                document.getElementById('statusText').textContent = '❌ Backend Offline';
            }
        }

        // Load demo data
        async function loadDemoData() {
            const demoProducts = [
                { product_id: 'P1003', risk_score: 0.6, top_issue_descriptor: 'runs_large' },
                { product_id: 'P1002', risk_score: 0.56, top_issue_descriptor: 'color_fade' },
                { product_id: 'P1001', risk_score: 0.5, top_issue_descriptor: 'runs_small' },
                { product_id: 'P1005', risk_score: 0.5, top_issue_descriptor: 'shrink' }
            ];
            
            displayResults(demoProducts);
        }

        // Display results
        function displayResults(products) {
            const resultsDiv = document.getElementById('results');
            const gridDiv = document.getElementById('productGrid');
            
            gridDiv.innerHTML = '';
            
            products.forEach(product => {
                const riskColor = product.risk_score > 0.55 ? 'bg-red-100 border-red-300' : 'bg-yellow-100 border-yellow-300';
                
                const card = `
                    <div class="border rounded-lg p-4 ${riskColor}">
                        <h3 class="font-bold text-lg">${product.product_id}</h3>
                        <p class="text-sm text-gray-600">Risk Score: ${product.risk_score.toFixed(2)}</p>
                        <p class="text-sm text-gray-800 mt-2">Top Issue: ${product.top_issue_descriptor}</p>
                        <div class="mt-2">
                            <div class="bg-gray-200 rounded-full h-2">
                                <div class="bg-primary h-2 rounded-full" style="width: ${product.risk_score * 100}%"></div>
                            </div>
                        </div>
                    </div>
                `;
                gridDiv.innerHTML += card;
            });
            
            resultsDiv.style.display = 'block';
        }

        // Upload files
        async function uploadFiles() {
            const reviewsFile = document.getElementById('reviewsFile').files[0];
            const returnsFile = document.getElementById('returnsFile').files[0];
            
            if (!reviewsFile || !returnsFile) {
                alert('Please select both CSV files');
                return;
            }
            
            const formData = new FormData();
            formData.append('reviews_csv', reviewsFile);
            formData.append('returns_csv', returnsFile);
            
            try {
                // Upload
                const uploadResponse = await fetch(`${API_BASE}/upload`, {
                    method: 'POST',
                    headers: { 'X-Auth-Token': AUTH_TOKEN },
                    body: formData
                });
                
                if (!uploadResponse.ok) throw new Error('Upload failed');
                
                // Process
                const processResponse = await fetch(`${API_BASE}/process`, {
                    method: 'POST',
                    headers: { 'X-Auth-Token': AUTH_TOKEN }
                });
                
                if (!processResponse.ok) throw new Error('Processing failed');
                
                // Get products
                const productsResponse = await fetch(`${API_BASE}/products`, {
                    headers: { 'X-Auth-Token': AUTH_TOKEN }
                });
                
                if (productsResponse.ok) {
                    const products = await productsResponse.json();
                    displayResults(products);
                } else {
                    throw new Error('Failed to fetch results');
                }
                
            } catch (error) {
                alert('Error: ' + error.message + '. Try using Demo Data instead.');
            }
        }

        // Initialize
        checkAPIStatus();
    </script>
</body>
</html>